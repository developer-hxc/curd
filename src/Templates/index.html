<template>
    <div>
        <Form :model="searchData" inline @submit.native.prevent="getData(1)" :label-width="80">
            {{hxc_search_form}}
            <Row>
                <Col span="12">
                <Button icon="ios-add" to="/{{hxc_controller_name}}/add">添加</Button>
                </Col>
                <Col span="12">
                <div style="text-align:right">
                    <Button type="primary" icon="ios-search" html-type="submit">搜索</Button>
                </div>
                </Col>
            </Row>
        </Form>
        <Table
                :columns="tableColumns"
                :data="tableData.data"
                :loading="tableLoading"
                style="margin-top:20px;"
        >
            <template slot-scope="{ row }" slot="action">
                <Button
                        type="primary"
                        size="small"
                        :to="'/{{hxc_controller_name}}/edit?id='+row.id"
                >编辑</Button>
                <Button type="error" size="small" @click="remove(row.id)">删除</Button>
            </template>
        </Table>
        <Page
                style="text-align:right;margin-top:20px"
                :total="tableData.total"
                :page-size="tableData.per_page"
                show-total
                @on-change="getData"
        />
    </div>
</template>
<script>
    export default {
        data() {
            return {
                tableColumns:{{hxc_table_columns}},
                tableData: {
                    total: 0,
                    per_page: 0,
                    current_page: 1,
                    last_page: 1,
                    data: []
                },
                searchData: {{hxc_search_field}},
                tableLoading: false
            };
        },
        created() {
            this.getData(1);
        },
        methods: {
            getData(page) {
                this.tableLoading = true;
                let data = this.searchData;
                data.page = page;
                this.$httpRequest("/admin/{{hxc_controller_name}}/index", "get", data).then(res => {
                    this.tableData = res.data;
                    this.tableLoading = false;
                });
            },
            remove(id) {
                this.$Modal.confirm({
                    title: "您确定要删除这条数据吗？",
                    loading: true,
                    onOk: () => {
                        this.$httpRequest("/admin/{{hxc_controller_name}}/delete", "get", { id: id }).then(
                            res => {
                                this.$Modal.remove();
                                if (res.code == 1) {
                                    this.$Message.info("删除成功");
                                } else {
                                    this.$Message.error(res.msg);
                                }
                            }
                        );
                    }
                });
            }
        }
    };
</script>